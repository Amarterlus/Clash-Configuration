name: Dulun's Stash Rules
desc: æ·»åŠ Dulunçš„è‡ªå®šä¹‰è§„åˆ™

http:
  force-http-engine:
    - 'upos-*.bilivideo.com:80'
    - '*:4480'
    - '*:9102'
  url-rewrite:
    - https?:\/\/(.*):4480\/upgcxcode http://upos-sz-mirrorcos.bilivideo.com/upgcxcode 302
    - https?:\/\/(.*):9102\/upgcxcode http://upos-sz-mirrorcos.bilivideo.com/upgcxcode 302
    - https?:\/\/upos-.*-.*oss\d*\.bilivideo\.com\/upgcxcode http://upos-sz-mirrorcos.bilivideo.com/upgcxcode 302
    - https?:\/\/upos-sz-mirror(?!cos\.).*bilivideo\.com\/upgcxcode http://upos-sz-mirrorcos.bilivideo.com/upgcxcode 302
    # alternative:
    # upos-sz-mirrorhw.bilivideo.com
    # upos-sz-mirrorcos.bilivideo.com
    # upos-sz-mirrorcoso1.bilivideo.com
    # upos-sz-mirrorcoso2.bilivideo.com
    # upos-sz-mirrorbs.bilivideo.com
    # upos-sz-mirrorali.bilivideo.com
script:
  shortcuts:
    bilibili-quic: network == 'udp' and geoip(dst_ip) == 'CN' and dst_port == 3478

# proxy-groups:
#   - name: ğŸ‡­ğŸ‡° é¦™æ¸¯
#     type: select
#     include-all: true # å¼•ç”¨æ‰€æœ‰ proxies & proxy-providers
#     filter: 'ğŸ‡­ğŸ‡°|é¦™æ¸¯' # ç­›é€‰å«æœ‰ ğŸ‡­ğŸ‡° æˆ–é¦™æ¸¯å…³é”®å­—çš„ä»£ç†

rule-providers:
  proxy-domain:
    behavior: domain-text # ä½¿ç”¨ domain ç±»è§„åˆ™é›†ï¼Œå¯ä»¥ä½¿åŒ¹é…æ›´é«˜æ•ˆ
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/proxy.txt
    interval: 86400
 
  lan-cidr:
    behavior: ipcidr
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt
    interval: 86400
 
  ip-cidr-text:
    behavior: ipcidr-text
    url: https://cdn.jsdelivr.net/gh/17mon/china_ip_list@master/china_ip_list.txt
    interval: 86400

rules: #!replace
  - SCRIPT,bilibili-quic,REJECT,no-track
  - RULE-SET,lan-cidr,ğŸ¯ å…¨çƒç›´è¿,no-resolve
  - RULE-SET,ip-cidr-text,ğŸ¯ å…¨çƒç›´è¿,no-resolve
  - RULE-SET,proxy-domain,ğŸ”° èŠ‚ç‚¹é€‰æ‹©
  - GEOIP,CN,ğŸ¯ å…¨çƒç›´è¿,no-resolve
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼